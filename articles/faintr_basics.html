<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="faintr">
<title>Comparing groups of factor levels with faintr • faintr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.1.3/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.1.3/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Comparing groups of factor levels with faintr">
<meta property="og:description" content="faintr">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">faintr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9001</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/faintr_basics.html">Comparing groups of factor levels with faintr</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/michael-franke/faintr/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="faintr_basics_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Comparing groups of factor levels with faintr</h1>
                        <h4 data-toc-skip class="author">Michael Franke</h4>
            
            <h4 data-toc-skip class="date">2022-08-21</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/michael-franke/faintr/blob/HEAD/vignettes/faintr_basics.Rmd" class="external-link"><code>vignettes/faintr_basics.Rmd</code></a></small>
      <div class="d-none name"><code>faintr_basics.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="motivation">Motivation<a class="anchor" aria-label="anchor" href="#motivation"></a>
</h2>
<p>The <code>faintr</code> (FActorINTerpreteR) package provides convenience functions for evaluating Bayesian regression models for factorial designs, fitted with the <code>brms</code> package (Bürkner, 2017). The <code>faintr</code> package allows for the extraction of many meaningful comparisons irrespective of the encoding scheme initially used in the model. The package provides the following convenience functions:</p>
<ul>
<li>
<code>get_cell_definitions</code> returns information on the factors and their encoding in the model.</li>
<li>
<code>extract_cell_draws</code> provides posterior draws and metadata for one subset of factorial design cells.</li>
<li>
<code>compare_groups</code> allows the comparison of two subsets of factorial design cells.</li>
</ul>
<p>Currently, the package does not support multivariate models and models that use families <code>categorical</code>, <code>dirichlet</code>, <code>multinomial</code>, and <code>logistic_normal</code>. Furthermore, models must not include special effect terms <code><a href="https://rdrr.io/pkg/brms/man/mo.html" class="external-link">mo()</a></code>, <code><a href="https://rdrr.io/pkg/brms/man/mi.html" class="external-link">mi()</a></code>, <code><a href="https://rdrr.io/pkg/brms/man/me.html" class="external-link">me()</a></code>, and <code><a href="https://rdrr.io/pkg/brms/man/cs.html" class="external-link">cs()</a></code> for fixed effects. Also note that <code>faintr</code> currently does not support models where the intercept is a population-level parameter (class <code>b</code>), as is the case when using the <code>0 + Intercept</code> syntax in the <code>brm</code> function call.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the <code>faintr</code> package with <code>devtools</code> from GitHub:</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">require</a></span><span class="op">(</span><span class="va"><a href="https://devtools.r-lib.org/" class="external-link">devtools</a></span><span class="op">)</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">'devtools'</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">'michael-franke/faintr'</span>, build_vignettes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="setup">Setup<a class="anchor" aria-label="anchor" href="#setup"></a>
</h2>
<p>We will use the following packages in this vignette:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data wrangling</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyr.tidyverse.org" class="external-link">tidyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://mc-stan.org/posterior/" class="external-link">posterior</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># pipe operator</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://magrittr.tidyverse.org" class="external-link">magrittr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># fitting Bayesian regression models</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/paul-buerkner/brms" class="external-link">brms</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># evaluating Bayesian regression models </span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/michael-franke/faintr" class="external-link">faintr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># plotting</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># computing credible intervals</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">HDInterval</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="example-with-treatment-coding-dummy-coding">Example with treatment coding (dummy coding)<a class="anchor" aria-label="anchor" href="#example-with-treatment-coding-dummy-coding"></a>
</h2>
<p>The running data set in this vignette is borrowed from an experiment by Winter and Grawunder (2012) and is included in the <code>faintr</code> package. The data set stores measurements of voice pitch of male and female Korean speakers in polite and informal social contexts. The study followed a <span class="math inline">\(2 \times 2\)</span> factorial design with factor <code>gender</code> (M or F) and factor <code>context</code> (inf or pol), yielding a total of four possible factor level combinations (also called design cells). See <code><a href="../reference/politeness.html">?politeness</a></code> for more information on the data set.</p>
<p>Let’s peek at the first couple of rows:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">politeness</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 6 × 5</span></span></span>
<span><span class="co">##   subject gender sentence context pitch</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> F1      F      S1       pol      213.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> F1      F      S1       inf      204.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> F1      F      S2       pol      285.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> F1      F      S2       inf      260.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">5</span> F1      F      S3       pol      204.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">6</span> F1      F      S3       inf      287.</span></span></code></pre></div>
<p>The cell means of this data set are:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">politeness</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">context</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>mean_pitch <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">pitch</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 3</span></span></span>
<span><span class="co">## <span style="color: #949494;"># Groups:   gender [2]</span></span></span>
<span><span class="co">##   gender context mean_pitch</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span> F      inf           261.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span> F      pol           233.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span> M      inf           144.</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span> M      pol           133.</span></span></code></pre></div>
<p>A Bayesian regression model for this data set, fitted in <code>brms</code>, might look as follows. The model regresses voice pitch against factors <code>gender</code> and <code>context</code> (with interaction) and includes by-participant and by-sentence random intercepts.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_brms_politeness</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">pitch</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">*</span> <span class="va">context</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span> <span class="op">+</span> <span class="va">sentence</span><span class="op">)</span>,</span>
<span>                           data <span class="op">=</span> <span class="va">politeness</span>,</span>
<span>                           chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                           iter <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                           control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>,</span>
<span>                           cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                           seed <span class="op">=</span> <span class="fl">1234</span> <span class="co"># for reproducible results</span></span>
<span>                           <span class="op">)</span></span></code></pre></div>
<p>Let’s look at the estimated coefficients:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/pkg/nlme/man/fixed.effects.html" class="external-link">fixef</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span><span class="op">)</span></span>
<span><span class="co">##                      Estimate Est.Error        Q2.5     Q97.5</span></span>
<span><span class="co">## Intercept           260.97117 24.509305  214.805833 305.65970</span></span>
<span><span class="co">## genderM            -116.33043 38.491076 -191.939831 -45.90558</span></span>
<span><span class="co">## contextpol          -27.23192  7.717121  -43.091737 -11.27604</span></span>
<span><span class="co">## genderM:contextpol   15.10265 10.869829   -4.903683  38.15758</span></span></code></pre></div>
<p>From the names of the model coefficients (or lack thereof), we can infer that the model must have dummy-coded the factors, which is the default encoding scheme of the <code>brm</code> function. The estimated intercept in dummy coding constitutes the reference level, here female speakers (<code>gender:F</code>) in informal contexts (<code>context:inf</code>). All remaining factor level combinations can be retrieved by adding the corresponding slope coefficients to the estimated intercept.</p>
<div class="section level3">
<h3 id="get_cell_definitions">
<code>get_cell_definitions</code><a class="anchor" aria-label="anchor" href="#get_cell_definitions"></a>
</h3>
<p>We can use the function <code>get_cell_definitions</code> of the <code>faintr</code> package to obtain information on the factors and their internal encoding in the model:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_cell_definitions.html">get_cell_definitions</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 7</span></span></span>
<span><span class="co">##    cell gender context Intercept genderM contextpol `genderM:contextpol`</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 F      pol             1       0          1                    0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2 F      inf             1       0          0                    0</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3 M      pol             1       1          1                    1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4 M      inf             1       1          0                    0</span></span></code></pre></div>
<p>Generally, we can retrieve the estimate for a design cell by taking the dot product between the row of interest in the design matrix and the estimated coefficients. For instance, the estimated mean for the cell with data from male speakers in informal contexts is given by</p>
<p><span class="math display">\[\begin{equation}
  
  \mu_{\text{(M, inf)}} =

  \begin{bmatrix} 
    1 &amp; 1 &amp; 0 &amp; 0
  \end{bmatrix}

  \begin{bmatrix} 
    260.97117 \\ 
      -116.33043 \\
      -27.23192 \\
      15.10265 \\
  \end{bmatrix}

  \approx

  144.64
  
\end{equation}\]</span></p>
</div>
<div class="section level3">
<h3 id="extract_cell_draws">
<code>extract_cell_draws</code><a class="anchor" aria-label="anchor" href="#extract_cell_draws"></a>
</h3>
<p>Manually adding model coefficients can get tedious and error-prone very quickly, especially for models with more factors, more levels within factors or more complicated encoding schemes. With the function <code>extract_cell_draws</code> from the <code>faintr</code> package, we can extract posterior samples using a simple filter-syntax. To extract posterior draws for, say, male speakers in informal contexts, we do:</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'inf'</span><span class="op">)</span></span>
<span><span class="co">## # A draws_df: 250 iterations, 2 chains, and 1 variables</span></span>
<span><span class="co">##    draws</span></span>
<span><span class="co">## 1    124</span></span>
<span><span class="co">## 2    150</span></span>
<span><span class="co">## 3    140</span></span>
<span><span class="co">## 4    161</span></span>
<span><span class="co">## 5    147</span></span>
<span><span class="co">## 6    129</span></span>
<span><span class="co">## 7    160</span></span>
<span><span class="co">## 8    150</span></span>
<span><span class="co">## 9    161</span></span>
<span><span class="co">## 10   158</span></span>
<span><span class="co">## # ... with 490 more draws</span></span>
<span><span class="co">## # ... hidden reserved variables {'.chain', '.iteration', '.draw'}</span></span></code></pre></div>
<p>We can also use negations and disjunctions to subset design cells:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, <span class="va">gender</span> <span class="op">!=</span> <span class="st">'F'</span> <span class="op">|</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'inf'</span><span class="op">)</span></span>
<span><span class="co">## # A draws_df: 250 iterations, 2 chains, and 1 variables</span></span>
<span><span class="co">##    draws</span></span>
<span><span class="co">## 1    167</span></span>
<span><span class="co">## 2    192</span></span>
<span><span class="co">## 3    167</span></span>
<span><span class="co">## 4    178</span></span>
<span><span class="co">## 5    184</span></span>
<span><span class="co">## 6    171</span></span>
<span><span class="co">## 7    193</span></span>
<span><span class="co">## 8    182</span></span>
<span><span class="co">## 9    180</span></span>
<span><span class="co">## 10   192</span></span>
<span><span class="co">## # ... with 490 more draws</span></span>
<span><span class="co">## # ... hidden reserved variables {'.chain', '.iteration', '.draw'}</span></span></code></pre></div>
<p>To extract posterior draws for only a part of the factors used in the model, we simply omit the unwanted factors in the group specification. Here we are interested in voice pitch in polite contexts, averaged over male and female speakers. Let’s also set a more informative column name:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, <span class="va">context</span> <span class="op">==</span> <span class="st">'pol'</span>, colname <span class="op">=</span> <span class="st">'context:pol'</span><span class="op">)</span></span>
<span><span class="co">## # A draws_df: 250 iterations, 2 chains, and 1 variables</span></span>
<span><span class="co">##    context:pol</span></span>
<span><span class="co">## 1          180</span></span>
<span><span class="co">## 2          202</span></span>
<span><span class="co">## 3          166</span></span>
<span><span class="co">## 4          172</span></span>
<span><span class="co">## 5          190</span></span>
<span><span class="co">## 6          181</span></span>
<span><span class="co">## 7          191</span></span>
<span><span class="co">## 8          182</span></span>
<span><span class="co">## 9          176</span></span>
<span><span class="co">## 10         193</span></span>
<span><span class="co">## # ... with 490 more draws</span></span>
<span><span class="co">## # ... hidden reserved variables {'.chain', '.iteration', '.draw'}</span></span></code></pre></div>
<p>Furthermore, we can extract posterior draws for the grand mean, i.e., the mean of all design cells together. We can do so by not specifying any group level in the function call:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, colname <span class="op">=</span> <span class="st">'grand_mean'</span><span class="op">)</span></span>
<span><span class="co">## # A draws_df: 250 iterations, 2 chains, and 1 variables</span></span>
<span><span class="co">##    grand_mean</span></span>
<span><span class="co">## 1         188</span></span>
<span><span class="co">## 2         210</span></span>
<span><span class="co">## 3         176</span></span>
<span><span class="co">## 4         182</span></span>
<span><span class="co">## 5         200</span></span>
<span><span class="co">## 6         188</span></span>
<span><span class="co">## 7         202</span></span>
<span><span class="co">## 8         196</span></span>
<span><span class="co">## 9         187</span></span>
<span><span class="co">## 10        203</span></span>
<span><span class="co">## # ... with 490 more draws</span></span>
<span><span class="co">## # ... hidden reserved variables {'.chain', '.iteration', '.draw'}</span></span></code></pre></div>
<p>We can use the output of <code>extract_cell_draws</code> for inspecting and comparing posterior draws visually:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">draws_gender</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/bind_draws.html" class="external-link">bind_draws</a></span><span class="op">(</span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span>, colname <span class="op">=</span> <span class="st">'male'</span><span class="op">)</span>,</span>
<span>                           <span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, <span class="va">gender</span> <span class="op">==</span> <span class="st">'F'</span>, colname <span class="op">=</span> <span class="st">'female'</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">draws_gender</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://tidyr.tidyverse.org/reference/pivot_longer.html" class="external-link">pivot_longer</a></span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://mc-stan.org/posterior/reference/draws-index.html" class="external-link">variables</a></span><span class="op">(</span><span class="va">.</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">'group'</span>, values_to <span class="op">=</span> <span class="st">'draws'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">draws</span>, color <span class="op">=</span> <span class="va">group</span>, fill <span class="op">=</span> <span class="va">group</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_density.html" class="external-link">geom_density</a></span><span class="op">(</span>alpha <span class="op">=</span> <span class="fl">.4</span><span class="op">)</span></span></code></pre></div>
<p><img src="faintr_basics_files/figure-html/cell-draws-dummy-plot-1.png" width="384" style="display: block; margin: auto;"></p>
<p>Or in conjunction with the <code>summarise</code> function of the <code>dplyr</code> package (Wickham et al., 2022) to obtain useful summary statistics, such as means and credible intervals:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'pol'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    `|95%` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    mean   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span>,</span>
<span>    `95%|` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   `|95%`  mean `95%|`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   86.6  133.   185.</span></span></code></pre></div>
<p>Because <code>extract_cell_draws</code> returns the draws in <code>draws_df</code> format as provided by the <code>posterior</code> package (Bürkner et al., 2022), we can easily access the many convenience functions it offers. Here we subset the draws for the first ten iterations of the first chain using <code>subset_draws</code>:</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'pol'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://mc-stan.org/posterior/reference/subset_draws.html" class="external-link">subset_draws</a></span><span class="op">(</span>variable <span class="op">=</span> <span class="st">'draws'</span>, chain <span class="op">=</span> <span class="fl">1</span>, iteration <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">10</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://pillar.r-lib.org/reference/glimpse.html" class="external-link">glimpse</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">## Rows: 10</span></span>
<span><span class="co">## Columns: 4</span></span>
<span><span class="co">## $ draws      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> 109.2502, 136.5876, 131.3179, 149.1211, 131.1111, 122.0383,…</span></span>
<span><span class="co">## $ .chain     <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 1, 1, 1, 1, 1, 1, 1, 1, 1</span></span>
<span><span class="co">## $ .iteration <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span>
<span><span class="co">## $ .draw      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="compare_groups">
<code>compare_groups</code><a class="anchor" aria-label="anchor" href="#compare_groups"></a>
</h3>
<p>To compare different (groups of) cells to each other, the <code>faintr</code> package provides the function <code>compare_groups</code>. The function returns the mean difference between the ‘higher’ and ‘lower’ group specification, its credible interval (defaults to 95%), as well as the posterior probability and odds that the mean estimate for the ‘higher’ group is higher than that of the ‘lower’ group.</p>
<p>Although the fit of the regression model uses a particular reference cell for dummy coding (female speakers in informal contexts), other contrasts of relevance can be retrieved from the posterior samples. For example, if we want to compare two cells diagonally, say, female speakers in polite contexts against male speakers in informal contexts, we can do this like so:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_groups.html">compare_groups</a></span><span class="op">(</span></span>
<span>  fit  <span class="op">=</span> <span class="va">fit_brms_politeness</span>,</span>
<span>  higher <span class="op">=</span> <span class="va">gender</span> <span class="op">==</span> <span class="st">'F'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'pol'</span>,</span>
<span>  lower  <span class="op">=</span> <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'inf'</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Outcome of comparing groups: </span></span>
<span><span class="co">##  * higher:  gender == "F" &amp; context == "pol" </span></span>
<span><span class="co">##  * lower:   gender == "M" &amp; context == "inf" </span></span>
<span><span class="co">## Mean 'higher - lower':  89.1 </span></span>
<span><span class="co">## 95% HDI:  [ 16.55 ; 163.4 ]</span></span>
<span><span class="co">## P('higher - lower' &gt; 0):  0.994 </span></span>
<span><span class="co">## Posterior odds:  165.7</span></span></code></pre></div>
<p>As before, we can use negations and disjunctions in the group specifications. Let us also lower the mass in the highest density interval (HDI) to 0.89 in this comparison:</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_groups.html">compare_groups</a></span><span class="op">(</span></span>
<span> fit  <span class="op">=</span> <span class="va">fit_brms_politeness</span>, </span>
<span> higher <span class="op">=</span> <span class="va">gender</span> <span class="op">==</span> <span class="st">'F'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">!=</span> <span class="st">'pol'</span>,</span>
<span> lower  <span class="op">=</span> <span class="va">gender</span> <span class="op">!=</span> <span class="st">'F'</span> <span class="op">|</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'pol'</span>,</span>
<span> hdi    <span class="op">=</span> <span class="fl">0.89</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Outcome of comparing groups: </span></span>
<span><span class="co">##  * higher:  gender == "F" &amp; context != "pol" </span></span>
<span><span class="co">##  * lower:   gender != "F" | context == "pol" </span></span>
<span><span class="co">## Mean 'higher - lower':  90.67 </span></span>
<span><span class="co">## 89% HDI:  [ 49.23 ; 124.3 ]</span></span>
<span><span class="co">## P('higher - lower' &gt; 0):  0.996 </span></span>
<span><span class="co">## Posterior odds:  249</span></span></code></pre></div>
<p>If we want to compare male and female speakers only (that is, irrespective of contexts), we simply omit the <code>context</code> variable in the group specifications:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_groups.html">compare_groups</a></span><span class="op">(</span></span>
<span> fit  <span class="op">=</span> <span class="va">fit_brms_politeness</span>, </span>
<span> higher <span class="op">=</span> <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span>,</span>
<span> lower  <span class="op">=</span> <span class="va">gender</span> <span class="op">==</span> <span class="st">'F'</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Outcome of comparing groups: </span></span>
<span><span class="co">##  * higher:  gender == "M" </span></span>
<span><span class="co">##  * lower:   gender == "F" </span></span>
<span><span class="co">## Mean 'higher - lower':  -108.8 </span></span>
<span><span class="co">## 95% HDI:  [ -177.4 ; -32.96 ]</span></span>
<span><span class="co">## P('higher - lower' &gt; 0):  0.004 </span></span>
<span><span class="co">## Posterior odds:  0.004016</span></span></code></pre></div>
<p>We can also compare the effect of female speakers against the grand mean, to retrieve the information normally obtained by sum coding. To do so, we leave out one of the two group specifications in the function call (here the ‘lower’ group):</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/compare_groups.html">compare_groups</a></span><span class="op">(</span></span>
<span>  fit  <span class="op">=</span> <span class="va">fit_brms_politeness</span>,</span>
<span>  higher <span class="op">=</span> <span class="va">gender</span> <span class="op">==</span> <span class="st">'F'</span></span>
<span><span class="op">)</span></span>
<span><span class="co">## Outcome of comparing groups: </span></span>
<span><span class="co">##  * higher:  gender == "F" </span></span>
<span><span class="co">##  * lower:   grand mean </span></span>
<span><span class="co">## Mean 'higher - lower':  54.39 </span></span>
<span><span class="co">## 95% HDI:  [ 16.48 ; 88.7 ]</span></span>
<span><span class="co">## P('higher - lower' &gt; 0):  0.996 </span></span>
<span><span class="co">## Posterior odds:  249</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="example-with-sum-coding">Example with sum coding<a class="anchor" aria-label="anchor" href="#example-with-sum-coding"></a>
</h2>
<p>The <code>faintr</code> package also works for models with different contrast coding schemes. Notice that as long as we use uninformative (improper) priors over coefficients, the results for estimators of various design cells should be the same (or very similar, given natural variation in sampling) across coding schemes.</p>
<p>To see this, here is a model with sum-coded predictor variables, all else equal to the case from before.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># make predictors 'factors' because that's required for contrast coding</span></span>
<span><span class="co">#   also: change order to match coding assumed in the main text</span></span>
<span><span class="va">politeness_sum</span> <span class="op">&lt;-</span> <span class="va">politeness</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span></span>
<span>    gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">gender</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'M'</span>, <span class="st">'F'</span><span class="op">)</span><span class="op">)</span>,</span>
<span>    context <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">context</span>, levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'pol'</span>, <span class="st">'inf'</span><span class="op">)</span><span class="op">)</span></span>
<span>  <span class="op">)</span></span>
<span></span>
<span><span class="co"># apply 'sum' contrasts</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html" class="external-link">contrasts</a></span><span class="op">(</span><span class="va">politeness_sum</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/contrast.html" class="external-link">contr.sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html" class="external-link">contrasts</a></span><span class="op">(</span><span class="va">politeness_sum</span><span class="op">$</span><span class="va">context</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/contrast.html" class="external-link">contr.sum</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># add intelligible names to the new contrast coding</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html" class="external-link">contrasts</a></span><span class="op">(</span><span class="va">politeness_sum</span><span class="op">$</span><span class="va">gender</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">':M'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/colnames.html" class="external-link">colnames</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/stats/contrasts.html" class="external-link">contrasts</a></span><span class="op">(</span><span class="va">politeness_sum</span><span class="op">$</span><span class="va">context</span><span class="op">)</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="st">':pol'</span></span>
<span></span>
<span><span class="co"># run brm as usual</span></span>
<span><span class="va">fit_brms_politeness_sum</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">pitch</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">*</span> <span class="va">context</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span> <span class="op">+</span> <span class="va">sentence</span><span class="op">)</span>,</span>
<span>                               data <span class="op">=</span> <span class="va">politeness_sum</span>,</span>
<span>                               chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                               iter <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                               control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>,</span>
<span>                               cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                               seed <span class="op">=</span> <span class="fl">1234</span></span>
<span>                               <span class="op">)</span></span></code></pre></div>
<p>A call to <code>get_cell_definitions</code> shows how our predictor variables are encoded in the newly fitted model:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_cell_definitions.html">get_cell_definitions</a></span><span class="op">(</span><span class="va">fit_brms_politeness_sum</span><span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 4 × 7</span></span></span>
<span><span class="co">##    cell gender context Intercept `gender:M` `context:pol` `gender:M:context:pol`</span></span>
<span><span class="co">##   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;fct&gt;</span>       <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>                  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>     1 F      pol             1         -<span style="color: #BB0000;">1</span>             1                     -<span style="color: #BB0000;">1</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">2</span>     2 F      inf             1         -<span style="color: #BB0000;">1</span>            -<span style="color: #BB0000;">1</span>                      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">3</span>     3 M      pol             1          1             1                      1</span></span>
<span><span class="co">## <span style="color: #BCBCBC;">4</span>     4 M      inf             1          1            -<span style="color: #BB0000;">1</span>                     -<span style="color: #BB0000;">1</span></span></span></code></pre></div>
<p>As can be seen in the output, factor <code>gender</code> is now coded 1 for male speakers, and -1 for female speakers. Likewise, factor <code>context</code> is coded 1 for polite contexts, and -1 for informal contexts. Importantly, the estimated coefficients in the sum-coded model do not reflect the difference to a reference level (as in treatment coding), but the difference to the grand mean (i.e., the mean of all design cells).</p>
<p>Here are summary statistics for the estimated posterior for male speakers in polite contexts for the model with sum coding:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness_sum</span>, <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'pol'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    `|95%` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    mean   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span>,</span>
<span>    `95%|` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   `|95%`  mean `95%|`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   87.6  136.   190.</span></span></code></pre></div>
<p>This is nearly identical (modulo sampling variation) to the results we obtained above (repeated here) for the previous model with treatment coding:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span>, <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'pol'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    `|95%` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    mean   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span>,</span>
<span>    `95%|` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   `|95%`  mean `95%|`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   86.6  133.   185.</span></span></code></pre></div>
<p>For emphasis: If you fit a model with any prior structure on the model coefficients other than uniform/uninformative priors, it is not guaranteed that the results are the same for models with different contrast coding schemes. For illustration, consider the sum-coded model from before with a skeptical prior on coefficients <code>gender:M</code> and <code>context:pol</code>:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># skeptical prior on fixed effects</span></span>
<span><span class="va">priors</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html" class="external-link">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, coef <span class="op">=</span> <span class="va">`gender:M`</span><span class="op">)</span>,</span>
<span>  <span class="fu"><a href="https://rdrr.io/pkg/brms/man/set_prior.html" class="external-link">prior</a></span><span class="op">(</span><span class="fu">normal</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">10</span><span class="op">)</span>, coef <span class="op">=</span> <span class="va">`context:pol`</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run brm as usual</span></span>
<span><span class="va">fit_brms_politeness_sum_prior</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/brms/man/brm.html" class="external-link">brm</a></span><span class="op">(</span>formula <span class="op">=</span> <span class="va">pitch</span> <span class="op">~</span> <span class="va">gender</span> <span class="op">*</span> <span class="va">context</span> <span class="op">+</span> <span class="op">(</span><span class="fl">1</span> <span class="op">|</span> <span class="va">subject</span> <span class="op">+</span> <span class="va">sentence</span><span class="op">)</span>,</span>
<span>                                     data <span class="op">=</span> <span class="va">politeness_sum</span>,</span>
<span>                                     prior <span class="op">=</span> <span class="va">priors</span>,</span>
<span>                                     chains <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                     iter <span class="op">=</span> <span class="fl">500</span>,</span>
<span>                                     control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>adapt_delta <span class="op">=</span> <span class="fl">0.99</span><span class="op">)</span>,</span>
<span>                                     cores <span class="op">=</span> <span class="fl">2</span>,</span>
<span>                                     seed <span class="op">=</span> <span class="fl">1234</span></span>
<span>                                     <span class="op">)</span></span></code></pre></div>
<p>The priors we have chosen here translate into a prior belief that there is likely no difference between a given factor level and the grand mean. Since the data set is relatively small, the priors have a strong influence on the resulting posterior estimates:</p>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness_sum_prior</span>, <span class="va">gender</span> <span class="op">==</span> <span class="st">'M'</span> <span class="op">&amp;</span> <span class="va">context</span> <span class="op">==</span> <span class="st">'pol'</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    `|95%` <span class="op">=</span> <span class="fu">HDInterval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    mean   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span>,</span>
<span>    `95%|` <span class="op">=</span> <span class="fu">HDInterval</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   `|95%`  mean `95%|`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   127.  184.   249.</span></span></code></pre></div>
<p>As expected, the posterior estimate for male speakers in polite contexts strongly deviates from the estimate for the same factor level under the dummy-coded model from before. In fact, the estimate is now much closer to the grand mean (which makes sense given the way we informed the model).</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/extract_cell_draws.html">extract_cell_draws</a></span><span class="op">(</span><span class="va">fit_brms_politeness</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span></span>
<span>    `|95%` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, </span>
<span>    mean   <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span>,</span>
<span>    `95%|` <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/HDInterval/man/hdi.html" class="external-link">hdi</a></span><span class="op">(</span><span class="va">draws</span><span class="op">)</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span></span>
<span>  <span class="op">)</span></span>
<span><span class="co">## <span style="color: #949494;"># A tibble: 1 × 3</span></span></span>
<span><span class="co">##   `|95%`  mean `95%|`</span></span>
<span><span class="co">##    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>  <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">## <span style="color: #BCBCBC;">1</span>   163.  193.   226.</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<p>Bürkner P.-C. (2017). brms: An R Package for Bayesian Multilevel Models Using Stan. <em>Journal of Statistical Software</em>, <em>80</em>(1), 1-28. <a href="https://doi.org/10.18637/jss.v080.i01" class="external-link uri">https://doi.org/10.18637/jss.v080.i01</a>.</p>
<p>Bürkner P.-C., Gabry J., Kay M., Vehtari A. (2022). <em>posterior: Tools for Working with Posterior Distributions</em>. <a href="https://mc-stan.org/posterior/" class="external-link uri">https://mc-stan.org/posterior/</a>.</p>
<p>Wickham H., François R., Henry L., Müller K. (2022). <em>dplyr: A Grammar of Data Manipulation</em>. <a href="https://CRAN.R-project.org/package=dplyr" class="external-link uri">https://CRAN.R-project.org/package=dplyr</a>.</p>
<p>Winter B., Grawunder S. (2012). The Phonetic Profile of Korean Formality. <em>Journal of Phonetics</em>, <em>40</em>, 808-15.</p>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Özge Özenoglu, Noa Kallioinen, Michael Franke.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
